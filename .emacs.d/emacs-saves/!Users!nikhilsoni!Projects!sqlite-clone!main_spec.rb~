describe 'database' do
  def run_scripts(commands)
    row_output = nil
    IO.popen('./a.out', 'r+') do |pipe|
      commands.each do |command|
        pipe.puts command
      end

      pipe.close_write
      row_output = pipe.gets(nil)
    end

    raw_output.split("\n")
  end

  it 'insert and retreives a row' do
    result = run_scripts([
                           "insert 1, user1, u1@example.com",
                           "select",
                           ".exit",
                         ])
    expect(result).to match_array([
                                    "db > Executed.",
                                    "db > (1, user1, u1@example.com)",
                                    "Executed.",
                                    "db > ",
                                  ])
  end
end
