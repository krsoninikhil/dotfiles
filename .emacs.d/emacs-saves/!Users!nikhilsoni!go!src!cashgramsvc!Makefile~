BIN_DIR=$(PWD)/bin
BINARY=main
#DOCKER_IMAGE=nexus.cashfree.com:4000/payoutapi:latest
DOCKER_IMAGE=payoutapi:latest
APP=payoutapi

default: localrun

start: localrun

test:
	go test -v -cover -covermode=atomic ./...

vendor:
	@dep ensure -v

localclean:
	if [ -f ${BIN_DIR}/${BINARY}-local ]; then rm ${BIN_DIR}/${BINARY}-local; fi

local: vendor localclean
	go build -o ${BIN_DIR}/${BINARY}-local main.go

localrun: local
	./bin/${BINARY}-local

linuxclean:
	if [ -f ${BIN_DIR}/${BINARY}-linux ]; then rm ${BIN_DIR}/${BINARY}-linux; fi

linux: vendor linuxclean
	CGO_ENABLED=0 GOOS=linux go build -a -o ${BIN_DIR}/${BINARY}-linux main.go

linuxrun: linux
	./bin/${BINARY}-linux

docker: linux
	docker build -t ${DOCKER_IMAGE} .

all: local docker

clean: localclean linuxclean
	go clean -testcache

cleanvendor:
	rm -rf vendor

rebuild: cleanvendor clean vendor all

startdocker: #docker
	docker run --rm -v ${PWD}/config:/entrypoint/config -p 9188:9188 --name ${APP} -ti ${DOCKER_IMAGE}

swaggerspecs:
	swagger generate spec -m -i swagger/swagger.yml -o ./swagger.json
