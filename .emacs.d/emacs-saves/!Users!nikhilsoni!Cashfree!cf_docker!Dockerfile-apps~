FROM php:5.6-apache

# RUN printf "\n%s\n%s" "@edge http://dl-cdn.alpinelinux.org/alpine/edge/main" "@testing http://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories \
#     && apk --update upgrade \
#     && apk add autoconf automake make gcc g++ libtool pkgconfig libmcrypt-dev re2c libressl@edge libressl-dev@edge git zlib-dev xdg-utils libpng-dev freetype-dev libjpeg-turbo-dev openssh-client libxslt-dev ca-certificates gmp-dev \
#     && update-ca-certificates

RUN apt-get -qq update \
    && apt-get -qq -y install autoconf automake make gcc g++ libtool libmcrypt-dev re2c git xdg-utils libpng-dev openssh-client libxslt-dev ca-certificates libssl-dev libcurl4-openssl-dev pkg-config libmemcached-dev zlib1g-dev

#REMOVED mcrypt xmlreader
RUN docker-php-ext-install -j$(grep -c ^processor /proc/cpuinfo 2>/dev/null || 1) \
gd xmlrpc mbstring bcmath zip xml \
xmlwriter simplexml soap json iconv fileinfo dom xsl pcntl pdo sockets

RUN docker-php-ext-configure pdo_mysql --with-pdo-mysql=mysqlnd && \
    docker-php-ext-install pdo_mysql && \
    # docker-php-ext-configure mysql --with-mysql=mysqlnd && \
    # docker-php-ext-install mysql && \
    docker-php-ext-configure mysqli --with-mysqli=mysqlnd && \
    docker-php-ext-install mysqli

RUN pecl install mongodb \
    && docker-php-ext-enable mongodb

RUN pecl install apcu-4.0.11 \
    && docker-php-ext-enable apcu

##ADDED FOR PHP7
#RUN bash -c "echo extension=apc.so > /usr/local/etc/php/conf.d/z_apc.ini"

RUN pecl install memcached-2.2.0 \
    && docker-php-ext-enable memcached

RUN rm -rf /var/cache/apk && mkdir -p /var/cache/apk

RUN a2enmod rewrite
# COPY php7.ini /usr/local/etc/php/php.ini

ENV CFStage "DEVO"

# to get the error logs from cron, as the coded redirection is as per production setup
RUN mkdir -p /var/log/httpd \
    && ln -s /var/log/apache2/error.log /var/log/httpd/error.log

# uncomment to build for deployment
# COPY cfroot/ /cfroot/

# COPY . /var/www/html/

