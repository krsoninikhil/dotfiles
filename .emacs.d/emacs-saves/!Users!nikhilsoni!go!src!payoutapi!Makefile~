BIN_DIR=$(PWD)/bin
BINARY=main

test:
	go test -v -cover -covermode=atomic ./...

vendor:
	@dep ensure -v

darwinclean:
	if [ -f ${BIN_DIR}/${BINARY}-darwin ]; then rm ${BIN_DIR}/${BINARY}-darwin; fi

darwin: vendor darwinclean
	go build -o ${BIN_DIR}/${BINARY}-darwin main.go

linuxclean:
	if [ -f ${BIN_DIR}/${BINARY}-linux ]; then rm ${BIN_DIR}/${BINARY}-linux; fi

linux: vendor linuxclean
	CGO_ENABLED=0 GOOS=linux go build -a -o ${BIN_DIR}/${BINARY}-linux main.go

cleanvendor:
	rm -rf vendor

clean: darwinclean linuxclean
	go clean -testcache

rebuild: cleanvendor clean vendor default

docker:
